//Generic thumbnail jquery plugin
//https://github.com/tangentsnowball/Plugins/tree/master/jquery.thumbnailer
//last updated: 18/7/12
//requires: jquery >= 1.4.4 and plugin stylesheet
//by Andy Sellick, Tangent Snowball http://www.tangentsnowball.com/
(function(e){e.fn.thumbnailer=function(t){function r(n,r,i,s){var o=0;var u=i.find(".thumbwrapper ul");var a=i.find(".thumbwrapper").width();var f=e(u).position();var l=e(u).width();if(r){o=f.left+s*t.scrollThumbs;if(o<=0){e(u).animate({left:o},300,function(){if(o==0){n.removeClass("active")}else{n.addClass("active")}});i.find(".rightnavclick").addClass("active")}}else{result=f.left+l-a;if(result>=0){var r=f.left-s*t.scrollThumbs;e(u).animate({left:r},300,function(){if(result-s<0){n.removeClass("active")}else{n.addClass("active")}});i.find(".leftnavclick").addClass("active")}}return false}function i(e,t){var n=e.parent().offset();var r=e.find(".zoomlens");var i=Math.min(Math.max(t.pageY-n.top-r.height()/2,0),e.height()-r.height()-2);var s=Math.min(Math.max(t.pageX-n.left-r.width()/2,0),e.width()-r.width()-2);r.css({top:i,left:s});var o=e.find(".zoomer");var u=o.find("img");var a=e.find("img");var f=u.width();var l=u.height();var c=a.width();var h=a.height();var p=Math.floor(c/f*100);var d=Math.floor(h/l*100);var v=i/p*100;var m=s/d*100;var g=parseInt(a.css("margin-top"));var y=parseInt(a.css("margin-left"));g=g/d*100;y=y/p*100;v=v-g;m=m-y;u.css({top:-v,left:-m})}function s(e){var t=e.width();var n=e.height();var r=e.parent();var i=r.width();var s=r.height();var o=0;var u=0;if(t<i){o=Math.floor((i-t)/2)}if(n<s){u=Math.floor((s-n)/2)}e.css({"margin-left":o+"px","margin-top":u+"px"})}var n={zoom:1,captions:0,scrollThumbs:1,zoomPos:"outside",captionShow:0,zoomIndicator:1,zoomLocation:"right",thumbMinWidth:40,thumbMinHeight:40};var t=e.extend(n,t);return this.each(function(){var n=e(this);var o=0;var u=0;var a=t.thumbMinWidth;var f=t.thumbMinHeight;var l=n.find(".imagethumbs");var c=n.find(".imagethumbs ul li");var h=c.length;if(h>0){var p=h;var d=e("<div/>",{"class":"thumbwrapper"});var v=e("<div/>",{"class":"leftnavclick nav"}).html("<span></span>");var m=e("<div/>",{"class":"rightnavclick nav active"}).html("<span></span>");var g=l.html();d.append(g);var y=n.find(".thumbwrapper ul");c.each(function(t,r){var i=e(this);var c=i.find("img").attr("src");$temp=e("<img/>",{src:c+"?"+(new Date).getTime()}).load(function(){a=Math.max(a,parseFloat(this.width));f=Math.max(f,parseFloat(this.height));n.find(".thumbwrapper a").css({width:a,height:f});o=Math.max(o,a+16);u=Math.max(u,f+16);if(t==h-1){m.css("top",f/2);v.css("top",f/2);var r=o*p;l.html("");if(r>n.width()+20){l.append(d);l.append(v).append(m);d.css("margin","0px 26px")}else{l.append(d)}n.find(".thumbwrapper ul").width(r);d.height(f+20);l.find("a").each(function(){e(this).height(f).width(a);s(e(this).find("img"))});n.find(".thumbwrapper ul li:first").addClass("active")}}).appendTo(e(this))})}var b=n.find(".imagemain");var w=b.width();var E=b.height();var S=b.find("img").attr("src");b.find("img").attr("src","").attr("src",S).load(function(t){s(e(this));b.addClass("ready")});if(t.captions){var x=e(this).find("img").attr("alt");var T=e("<span/>",{"class":"caption"}).html(x).hide().appendTo(b).fadeIn("500");if(t.captionShow){T.css({"z-index":100})}}if(t.zoomIndicator){e("<div/>",{"class":"zoomindicator"}).prependTo(b)}e(".imagethumbs li").live("click",function(n){if(!e(this).hasClass("active")){var r=e(this).parents(".thumbnailwrapper");var i=e(this).find("a").get(0).href;var s=e(this).find("a").attr("rel");var o=r.find(".imagemain");var u=o.find("img");margintop=0;marginleft=0;o.find(".zoomer").remove();o.find(".zoomlens").remove();o.attr("href",i);o.removeClass("ready");u.attr("src","").attr("src",s).load(function(){if(u.width()<w){marginleft=(w-u.width())/2}else{marginleft=0}if(u.height()<E){margintop=(E-u.height())/2}else{margintop=0}u.css({"margin-top":margintop,"margin-left":marginleft})});r.find(".imagethumbs li").removeClass("active").removeClass("arrow");e(this).addClass("active");e(this).addClass("arrow");if(t.captions){var a=e(this).find("img").attr("alt");u.attr("alt",a);r.find(".caption").html(a)}}e(this).find("a").blur();n.preventDefault()});n.find(".leftnavclick.active").live("click",function(t){e(this).removeClass("active");r(e(this),1,n,o);t.preventDefault()});n.find(".rightnavclick.active").live("click",function(t){e(this).removeClass("active");r(e(this),0,n,o);t.preventDefault()});if(t.zoom){n.find(".imagemain").hover(function(n){if(e(this).hasClass("ready")){var r=e(this);if(t.zoomIndicator){r.find(".zoomindicator").stop(true,true).delay(150).fadeOut(150)}var s=r.find(".zoomer");if(!s.length){var o=r.find("img");var u=r.get(0).href;var a=r.width()+50;if(t.zoomPos=="inside"){a=0}if(t.zoomLocation=="left"){a=-a}if(u){$zoomdiv=e("<span/>",{"class":"zoomer"}).css({width:r.width(),height:r.height(),left:a,top:0}).appendTo(r);if(t.zoomPos=="inside"){$zoomdiv.css({border:0})}var f=o.width();var l=o.height();$zoomedimg=e("<img/>",{src:u}).hide().appendTo(r.find(".zoomer")).fadeIn("1000").load(function(){var s=e(this).width();var u=e(this).height();var a=f/s*100;var c=l/u*100;$lens=e("<span/>",{"class":"zoomlens"}).css({width:o.parent().width()/100*a,height:o.parent().height()/100*c}).hide(0,function(){if(t.zoomPos=="inside"){e(this).css({border:0,background:"none"})}}).appendTo(r).fadeIn("600");i(r,n)})}}else{e(this).find(".zoomer").stop(false,true).fadeIn("1000");e(this).find(".zoomlens").stop(false,true).fadeIn("600")}}},function(){e(this).find(".zoomer").stop(false,true).fadeOut("500");e(this).find(".zoomlens").stop(false,true).fadeOut("500");if(t.zoomIndicator){e(this).find(".zoomindicator").stop(true,true).delay(150).fadeIn(150)}});n.find(".zoomer").live("hover",function(){if(t.zoomPos!="inside"){e(this).parent().find(".zoomer").stop(false,true).fadeOut("500");e(this).parent().find(".zoomlens").stop(false,true).fadeOut("500")}});n.find(".imagemain").mousemove(function(t){i(e(this),t)})}n.find(".imagemain").click(function(e){e.preventDefault()})})}})(jQuery)